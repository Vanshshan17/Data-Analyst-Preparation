WITH temp_tt AS(
SELECT *,
DENSE_RANK() OVER(PARTITION BY customer_id ORDER BY order_date) AS "rnk",
CASE WHEN order_date= customer_pref_delivery_date THEN 1 ELSE 0 END AS order_type
FROM Delivery)

SELECT ROUND((SUM(order_type)/COUNT(*))*100,2) AS  immediate_percentage  FROM temp_tt WHERE rnk=1;